{% extends 'invent/base_store_clerk.html' %}
{% load static %}

{% block title %}Store Clerk Dashboard{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <!-- Header: greeting + branch badge + back/action area -->
  <div class="mb-3">
    <h2 class="mb-0" style="margin-top: -20px;">Hello {{ user.first_name|default:user.username }}</h2>
  </div>


  <!-- Messages -->
  {% if messages %}
  <div class="mb-3">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- IoT Device Stats (Clickable Cards) -->
  <div class="row text-center mb-4 dashboard-cards">
    <div class="col-sm-6 col-md-3 mb-3">
      <a href="{% url 'total_requests' %}?status=all" style="text-decoration:none;">
        <div class="dashboard-card p-3 shadow-sm text-center">
          <h6>Total Requests</h6>
          <h3>{{ total_requests }}</h3>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-md-3 mb-3">
      <a href="{% url 'total_requests' %}?status=Approved" style="text-decoration:none;">
        <div class="dashboard-card p-3 shadow-sm text-center">
          <h6>Approved Requests</h6>
          <h3>{{ approved_requests_count }}</h3>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-md-3 mb-3">
      <a href="{% url 'total_requests' %}?status=issued" style="text-decoration:none;">
        <div class="dashboard-card p-3 shadow-sm text-center">
          <h6>Devices Issued</h6>
          <h3>{{ devices_issued }}</h3>
        </div>
      </a>
    </div>

    <div class="col-sm-6 col-md-3 mb-3">
      <a href="{% url 'total_requests' %}?status=returned" style="text-decoration:none;">
        <div class="dashboard-card p-3 shadow-sm text-center">
          <h6>Devices Returned</h6>
          <h3>{{ devices_returned }}</h3>
        </div>
      </a>
    </div>
  </div>

  <!-- Recent Device Activity -->
  <div class="bg-white p-4 rounded shadow-sm mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
      <h5 class="mb-2 mb-sm-0">Recent Device Activity</h5>
    </div>
    <div class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Category</th>
            <th>Status</th>
            <th>Client</th>
            <th>Issued At</th>
          </tr>
        </thead>
        <tbody>
          {% for device in recent_devices %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ device.category }}</td>
            <td>
              <span class="badge badge-purple
                {% if device.status == 'available' %}bg-success
                {% elif device.status == 'issued' %}bg-primary
                {% elif device.status == 'returned' %}bg-secondary
                {% elif device.status == 'faulty' %}bg-danger
                {% else %}bg-dark{% endif %}">
                {{ device.get_status_display }}
              </span>
            </td>
            <td>
              {% if device.current_client %}
                {{ device.current_client.name }}
              {% else %}
                -
              {% endif %}
            </td>
            <td>{{ device.issued_at|default:"-"|date:"Y-m-d H:i" }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="8" class="text-center text-muted">No recent device activity found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<!-- Page specific JS (if any) -->
{% endblock %}