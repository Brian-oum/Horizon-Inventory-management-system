<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Store Clerk Panel{% endblock %}</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    {% block extra_css %}{% endblock %}

    <style>
        :root {
            --bs-primary: #198754;
            --bs-primary-rgb: 25, 135, 84;
            --sidebar-bg: #ffffff;
            --sidebar-text: #0f0f0f;
            --sidebar-accent: #6f42c1;
        }

        /* ===== BODY ===== */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
        }

        /* ===== SIDEBAR ===== */
        .sidebar-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 238px;
            height: 100vh;
            background: var(--sidebar-bg);
            border-right: 1px solid #e9ecef;
            z-index: 1030;
            display: flex;
            flex-direction: column;
            transition: left 0.3s ease-in-out;
        }

        .sidebar-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .sidebar-wrapper .nav-link {
            color: var(--sidebar-text);
            padding: 0.75rem 1rem;
            border-radius: 0.6rem;
            display: flex;
            align-items: center;
        }

        .sidebar-wrapper .nav-link i {
            color: var(--sidebar-accent);
            margin-right: 0.6rem;
            width: 20px;
            text-align: center;
        }

        .sidebar-wrapper .nav-link:hover {
            background: #f5f0ff;
            color: var(--sidebar-accent);
        }

        .sidebar-wrapper .nav-link.active {
            border: 2px solid var(--sidebar-accent);
            color: var(--sidebar-accent);
            background: #fff;
            font-weight: 600;
        }

        /* ===== SIDEBAR BOTTOM ===== */
        .sidebar-bottom {
            border-top: 1px solid #e9ecef;
            padding: 1rem;
            text-align: center;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            margin-left: 238px;
            padding: 1.5rem;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        /* ===== MOBILE HEADER ===== */
        .mobile-header {
            display: none;
        }

        /* ===== MOBILE VIEW ===== */
        @media (max-width: 768px) {
            .sidebar-wrapper {
                left: -238px;
                padding-top: 20px;
            }

            .sidebar-wrapper.show {
                left: 0;
            }

            .sidebar-user-info {
               display: block !important;
               visibility: visible !important;
               opacity: 1 !important;
               margin-top: 1rem;
               padding: 1rem;
            }

            .sidebar-user-info h5 {
               font-size: 1.2rem; /* Slightly larger for touch screens */
               color: #000 !important;
            }
            .main-content {
                margin-left: 0;
                padding-top: 70px;
            }

            .mobile-header {
                display: flex;
                align-items: center;
                gap: 1rem;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: 60px;
                background: #fff;
                padding: 0 1rem;
                border-bottom: 1px solid #e9ecef;
                z-index: 1040;
            }

            .mobile-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0,0,0,0.4);
                display: none;
                z-index: 1025;
            }

            .mobile-overlay.show {
                display: block;
            }
        }

        /* Dashboard Cards */
        .dashboard-card {
            background-color: #ffffff !important;
            border: 1px solid #6f42c1;
            border-radius: 12px;
            color: #000;
            transition: transform 0.2s;
            padding: 1.25rem;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        @media (max-width: 768px) {
            .dashboard-cards {
               display: grid !important;
               grid-template-columns: repeat(2, minmax(0, 1fr));
               gap: 0.45rem; /* tighter gap */
               margin-left: 0;
               margin-right: 0;
            }

            /* Kill Bootstrap column spacing */
            .dashboard-cards > [class*="col-"] {
               padding-left: 0 !important;
               padding-right: 0 !important;
               max-width: 100% !important;
            }

            /* Tighten card itself */
            .dashboard-card {
               padding: 0.45rem !important;
               width: 100%;
               min-height: 120px;
            }

            .dashboard-card h6 {
               font-size: 1rem;
               margin-bottom: 1.5rem;
            }

            .dashboard-card h3 {
               font-size: 1.2rem;
               margin-bottom: 0;
            }
        }
    </style>
</head>

<body>

<div class="mobile-header">
    <button class="btn btn-outline-secondary" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>
    <strong class="text-dark">Store Clerk</strong>
</div>

<div class="mobile-overlay" id="overlay"></div>

<nav class="sidebar-wrapper" id="sidebarMenu">
    <div class="sidebar-content">
        <div class="sidebar-user-info text-center mb-4">
            <h5 class="fw-bold mb-1">{{ user.first_name|default:user.username }}</h5>
            <p class="small text-muted mb-2">Store Clerk</p>
            
            {% if user_branch %}
                <span class="badge text-dark">Branch: {{ user_branch.name }}</span>
            {% else %}
                <span class="badge bg-light text-muted border">Branch: Unassigned</span>
            {% endif %}
        </div>

        <ul class="nav flex-column">
            <li class="nav-item mb-2">
                <a class="nav-link {% if request.resolver_match.url_name == 'store_clerk_dashboard' %}active{% endif %}"
                   href="{% url 'store_clerk_dashboard' %}">
                    <i class="fas fa-home"></i> <span>Home</span>
                </a>
            </li>

            <li class="nav-item mb-2">
                <a class="nav-link d-flex justify-content-between align-items-center {% if request.resolver_match.url_name == 'issue_device' %}active{% endif %}"
                   href="{% url 'issue_device' %}">
                    <span><i class="fas fa-box-open"></i> Issue IoT Device</span>
                    {% if pending_requests_count_for_sidebar > 0 %}
                        <span class="badge bg-danger rounded-pill">{{ pending_requests_count_for_sidebar }}</span>
                    {% endif %}
                </a>
            </li>

            <li class="nav-item mb-2">
                <a class="nav-link {% if request.resolver_match.url_name == 'return_device' %}active{% endif %}"
                   href="{% url 'return_device' %}">
                    <i class="fas fa-arrow-left"></i> <span>Return Device</span>
                </a>
            </li>

            <li class="nav-item mb-2">
                <a class="nav-link {% if request.resolver_match.url_name == 'upload_inventory' %}active{% endif %}"
                   href="{% url 'upload_inventory' %}">
                    <i class="fas fa-upload"></i> <span>Upload Inventory</span>
                </a>
            </li>

            <li class="nav-item mb-2">
                <a class="nav-link {% if request.resolver_match.url_name == 'reports' %}active{% endif %}"
                   href="{% url 'reports' %}">
                    <i class="fas fa-chart-line"></i> <span>Reports</span>
                </a>
            </li>
        </ul>
    </div>

    <div class="sidebar-bottom">
        <a href="{% url 'logout' %}" class="nav-link text-danger justify-content-center">
            <i class="fas fa-right-from-bracket"></i> Logout
        </a>
        <small class="text-muted d-block mt-2" style="font-size: 0.7rem;">HorizonIoT Company Ltd</small>
    </div>
</nav>

<main class="main-content">
    {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const sidebar = document.getElementById("sidebarMenu");
    const toggle = document.getElementById("sidebarToggle");
    const overlay = document.getElementById("overlay");

    if(toggle) {
        toggle.addEventListener("click", () => {
            sidebar.classList.toggle("show");
            overlay.classList.toggle("show");
        });
    }

    if(overlay) {
        overlay.addEventListener("click", () => {
            sidebar.classList.remove("show");
            overlay.classList.remove("show");
        });
    }
});
</script>

{% block extra_js %}{% endblock %}
</body>
</html>